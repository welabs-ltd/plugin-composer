(()=>{"use strict";var e={n:l=>{var t=l&&l.__esModule?()=>l.default:()=>l;return e.d(t,{a:t}),t},d:(l,t)=>{for(var a in t)e.o(t,a)&&!e.o(l,a)&&Object.defineProperty(l,a,{enumerable:!0,get:t[a]})},o:(e,l)=>Object.prototype.hasOwnProperty.call(e,l)};(()=>{const l=window.React,t=window.wp.element,a=window.wp.components,n=window.wp.i18n,s=window.wp.apiFetch;var o=e.n(s);function r(){const[e,s]=(0,t.useState)({}),[r,i]=(0,t.useState)(!0),[p,c]=(0,t.useState)(!1),[m,u]=(0,t.useState)(null),[g,_]=(0,t.useState)("general"),[d,b]=(0,t.useState)(!1);(0,t.useEffect)(()=>{const e=localStorage.getItem("plugin-composer-active-tab");e&&_(e)},[]),(0,t.useEffect)(()=>{w()},[]);const w=async()=>{try{const e=await o()({path:"/plugin-composer/v1/settings",method:"GET"});console.log("Loaded settings:",e),s(e)}catch(e){console.error("Error loading settings:",e),u({type:"error",message:(0,n.__)("Error loading settings.","welabs-plugin-composer")})}finally{i(!1)}},h=(e,l)=>{s(t=>({...t,[e]:l}))},y=()=>{b(!0)},E=()=>{b(!1)};return r?(0,l.createElement)("div",{style:{textAlign:"center",padding:"20px"}},(0,l.createElement)(a.Spinner,null),(0,l.createElement)("p",null,(0,n.__)("Loading settings...","welabs-plugin-composer"))):(0,l.createElement)("div",{className:"plugin-composer-settings"},m&&(0,l.createElement)(a.Notice,{status:m.type,isDismissible:!0,onRemove:()=>u(null)},m.message),(0,l.createElement)(a.TabPanel,{className:"plugin-composer-tabs",activeClass:"active-tab",initialTabName:g,onSelect:e=>{_(e),localStorage.setItem("plugin-composer-active-tab",e)},tabs:[{name:"general",title:(0,n.__)("General","welabs-plugin-composer"),className:"tab-general"},{name:"rate-limiting",title:(0,n.__)("Rate Limiting","welabs-plugin-composer"),className:"tab-rate-limiting"},{name:"validation",title:(0,n.__)("Validation Rules","welabs-plugin-composer"),className:"tab-validation"},{name:"file-settings",title:(0,n.__)("File Settings","welabs-plugin-composer"),className:"tab-file-settings"},{name:"advanced",title:(0,n.__)("Advanced","welabs-plugin-composer"),className:"tab-advanced"}]},t=>{var s,o,r,i;return(0,l.createElement)("div",{className:`tab-content tab-${t.name}`},(0,l.createElement)(a.Card,null,(0,l.createElement)(a.CardHeader,null,(0,l.createElement)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},(0,l.createElement)("div",null,(0,l.createElement)("h3",{style:{margin:0,fontSize:"1.2em",fontWeight:"500"}},(i=t.name,{general:(0,n.__)("General","welabs-plugin-composer"),"rate-limiting":(0,n.__)("Rate Limiting","welabs-plugin-composer"),validation:(0,n.__)("Validation Rules","welabs-plugin-composer"),"file-settings":(0,n.__)("File Settings","welabs-plugin-composer"),advanced:(0,n.__)("Advanced","welabs-plugin-composer")}[i]||i))),(0,l.createElement)(a.Button,{isSecondary:!0,onClick:y,disabled:p,style:{marginLeft:"auto"}},(0,n.__)("Reset to Defaults","welabs-plugin-composer")))),(0,l.createElement)(a.CardBody,null,"general"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.ToggleControl,{label:(0,n.__)("Allow Guest Access","welabs-plugin-composer"),help:(0,n.__)("Allow non-logged-in users to generate plugins","welabs-plugin-composer"),checked:e.allow_guest_access||!1,onChange:e=>h("allow_guest_access",e)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.SelectControl,{label:(0,n.__)("Required Capability","welabs-plugin-composer"),help:(0,n.__)("Minimum capability required for logged-in users","welabs-plugin-composer"),value:e.required_capability||"edit_posts",options:[{label:(0,n.__)("Read","welabs-plugin-composer"),value:"read"},{label:(0,n.__)("Edit Posts","welabs-plugin-composer"),value:"edit_posts"},{label:(0,n.__)("Publish Posts","welabs-plugin-composer"),value:"publish_posts"},{label:(0,n.__)("Manage Options","welabs-plugin-composer"),value:"manage_options"}],onChange:e=>h("required_capability",e)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.SelectControl,{label:(0,n.__)("Default Plugin Type","welabs-plugin-composer"),help:(0,n.__)("Default plugin type when generating new plugins","welabs-plugin-composer"),value:e.default_plugin_type||"container_based",options:[{label:(0,n.__)("Container Based","welabs-plugin-composer"),value:"container_based"},{label:(0,n.__)("Classic","welabs-plugin-composer"),value:"classic"}],onChange:e=>h("default_plugin_type",e)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{label:(0,n.__)("Default Namespace","welabs-plugin-composer"),help:(0,n.__)("Default namespace for generated plugins (e.g., MyPlugin or AB/AC for multi-word)","welabs-plugin-composer"),value:null!==(s=e.default_namespace)&&void 0!==s?s:"MyPlugin",onChange:e=>h("default_namespace",e),placeholder:"MyPlugin"})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{label:(0,n.__)("Default Author Name","welabs-plugin-composer"),help:(0,n.__)("Default author name for generated plugins","welabs-plugin-composer"),value:null!==(o=e.default_author_name)&&void 0!==o?o:"Your Name",onChange:e=>h("default_author_name",e),placeholder:"Your Name"})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{label:(0,n.__)("Default Author URL","welabs-plugin-composer"),help:(0,n.__)("Default author URL for generated plugins","welabs-plugin-composer"),value:null!==(r=e.default_author_url)&&void 0!==r?r:"https://example.com",onChange:e=>h("default_author_url",e),placeholder:"https://example.com"}))),"rate-limiting"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.RangeControl,{label:(0,n.__)("Rate Limit Attempts","welabs-plugin-composer"),help:(0,n.__)("Maximum number of plugin generation attempts per time period","welabs-plugin-composer"),value:parseInt(e.rate_limit_attempts)||5,onChange:e=>h("rate_limit_attempts",parseInt(e)),min:1,max:100})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Rate Limit Duration (seconds)","welabs-plugin-composer"),help:(0,n.__)("Time period for rate limiting in seconds","welabs-plugin-composer"),value:parseInt(e.rate_limit_duration)||3600,onChange:e=>h("rate_limit_duration",parseInt(e)||3600)}))),"validation"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Max Plugin Name Length","welabs-plugin-composer"),help:(0,n.__)("Maximum allowed length for plugin names","welabs-plugin-composer"),value:parseInt(e.max_plugin_name_length)||100,onChange:e=>h("max_plugin_name_length",parseInt(e)||100)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Max Description Length","welabs-plugin-composer"),help:(0,n.__)("Maximum allowed length for plugin descriptions","welabs-plugin-composer"),value:parseInt(e.max_description_length)||500,onChange:e=>h("max_description_length",parseInt(e)||500)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Max License Length","welabs-plugin-composer"),help:(0,n.__)("Maximum allowed length for license text","welabs-plugin-composer"),value:parseInt(e.max_license_length)||50,onChange:e=>h("max_license_length",parseInt(e)||50)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Max Author Name Length","welabs-plugin-composer"),help:(0,n.__)("Maximum allowed length for author names","welabs-plugin-composer"),value:parseInt(e.max_author_name_length)||100,onChange:e=>h("max_author_name_length",parseInt(e)||100)}))),"file-settings"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("File Permissions","welabs-plugin-composer"),help:(0,n.__)("Octal permissions for generated files (e.g., 755, 644)","welabs-plugin-composer"),value:parseInt(e.file_permissions)||755,onChange:e=>h("file_permissions",parseInt(e)||755)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",null,(0,l.createElement)("label",{className:"components-base-control__label"},(0,n.__)("Allowed Plugin Types","welabs-plugin-composer")),(0,l.createElement)("p",{className:"components-base-control__help"},(0,n.__)("Plugin types that users can generate. At least one must be selected.","welabs-plugin-composer")),(0,l.createElement)("div",{style:{marginTop:"8px"}},(0,l.createElement)("label",{style:{display:"flex",alignItems:"center",marginBottom:"8px"}},(0,l.createElement)("input",{type:"checkbox",checked:e.allowed_plugin_types?.includes("container_based")||!1,onChange:l=>{const t=e.allowed_plugin_types||["container_based","classic"];if(l.target.checked)h("allowed_plugin_types",[...t,"container_based"]);else{const l=t.filter(e=>"container_based"!==e);l.length>0&&(h("allowed_plugin_types",l),"container_based"===e.default_plugin_type&&h("default_plugin_type",l[0]))}},style:{marginRight:"8px"}}),(0,n.__)("Container Based","welabs-plugin-composer")),(0,l.createElement)("label",{style:{display:"flex",alignItems:"center"}},(0,l.createElement)("input",{type:"checkbox",checked:e.allowed_plugin_types?.includes("classic")||!1,onChange:l=>{const t=e.allowed_plugin_types||["container_based","classic"];if(l.target.checked)h("allowed_plugin_types",[...t,"classic"]);else{const l=t.filter(e=>"classic"!==e);l.length>0&&(h("allowed_plugin_types",l),"classic"===e.default_plugin_type&&h("default_plugin_type",l[0]))}},style:{marginRight:"8px"}}),(0,n.__)("Classic","welabs-plugin-composer"))),e.allowed_plugin_types&&0===e.allowed_plugin_types.length&&(0,l.createElement)("p",{style:{color:"#d63638",fontSize:"12px",marginTop:"4px"}},(0,n.__)("At least one plugin type must be selected.","welabs-plugin-composer")))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{label:(0,n.__)("Allowed File Extensions","welabs-plugin-composer"),help:(0,n.__)("Comma-separated list of allowed file extensions","welabs-plugin-composer"),value:Array.isArray(e.allowed_file_extensions)?e.allowed_file_extensions.join(", "):"",onChange:e=>h("allowed_file_extensions",e.split(",").map(e=>e.trim()).filter(e=>e)),placeholder:"php, js, css, json, md, txt, xml"}))),"advanced"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.ToggleControl,{label:(0,n.__)("Enable Debug Mode","welabs-plugin-composer"),help:(0,n.__)("Enable detailed logging for troubleshooting","welabs-plugin-composer"),checked:e.enable_debug_mode||!1,onChange:e=>h("enable_debug_mode",e)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.ToggleControl,{label:(0,n.__)("Auto-cleanup Generated Files","welabs-plugin-composer"),help:(0,n.__)("Automatically clean up generated files after download","welabs-plugin-composer"),checked:e.auto_cleanup_files||!0,onChange:e=>h("auto_cleanup_files",e)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("File Cleanup Delay (minutes)","welabs-plugin-composer"),help:(0,n.__)("Time to wait before cleaning up generated files","welabs-plugin-composer"),value:parseInt(e.file_cleanup_delay)||30,onChange:e=>h("file_cleanup_delay",parseInt(e)||30)})),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)(a.ToggleControl,{label:(0,n.__)("Enable Plugin Preview","welabs-plugin-composer"),help:(0,n.__)("Allow users to preview generated plugins before download","welabs-plugin-composer"),checked:e.enable_plugin_preview||!1,onChange:e=>h("enable_plugin_preview",e)}))))))}),(0,l.createElement)("div",{style:{marginTop:"20px",display:"flex",justifyContent:"flex-start",alignItems:"center"}},(0,l.createElement)(a.Button,{isPrimary:!0,onClick:async()=>{c(!0),u(null),console.log("Saving settings:",e),console.log("Rate limit attempts value:",e.rate_limit_attempts,"Type:",typeof e.rate_limit_attempts);try{const l=await o()({path:"/plugin-composer/v1/settings",method:"POST",data:e});l.success?(await w(),u({type:"success",message:(0,n.__)("Settings saved successfully!","welabs-plugin-composer")})):u({type:"error",message:l.errors?l.errors.join(", "):(0,n.__)("Error saving settings.","welabs-plugin-composer")})}catch(e){console.error("Error saving settings:",e);let l=(0,n.__)("Error saving settings.","welabs-plugin-composer");e.data&&e.data.errors&&(l=Array.isArray(e.data.errors)?e.data.errors.join(", "):e.data.errors),u({type:"error",message:l})}finally{c(!1)}},disabled:p},p?(0,l.createElement)(l.Fragment,null,(0,l.createElement)(a.Spinner,null),(0,n.__)("Saving...","welabs-plugin-composer")):(0,n.__)("Save Settings","welabs-plugin-composer"))),d&&(0,l.createElement)(a.Modal,{title:(0,n.__)("Confirm Reset","welabs-plugin-composer"),onClose:E,shouldCloseOnClickOutside:!1},(0,l.createElement)("div",{style:{padding:"20px"}},(0,l.createElement)("p",null,(0,n.__)("Are you sure you want to reset all settings to their default values?","welabs-plugin-composer")),(0,l.createElement)("p",{style:{color:"#d63638",fontSize:"12px",marginTop:"4px"}},(0,n.__)("This action cannot be undone.","welabs-plugin-composer"))),(0,l.createElement)("div",{style:{padding:"20px",display:"flex",justifyContent:"flex-end",gap:"10px"}},(0,l.createElement)(a.Button,{isSecondary:!0,onClick:E},(0,n.__)("Cancel","welabs-plugin-composer")),(0,l.createElement)(a.Button,{isPrimary:!0,onClick:async()=>{b(!1),c(!0),u(null);try{(await o()({path:"/plugin-composer/v1/settings/reset",method:"POST"})).success?(await w(),u({type:"success",message:(0,n.__)("Settings reset to defaults successfully!","welabs-plugin-composer")})):u({type:"error",message:(0,n.__)("Error resetting settings.","welabs-plugin-composer")})}catch(e){console.error("Error resetting settings:",e),u({type:"error",message:(0,n.__)("Error resetting settings.","welabs-plugin-composer")})}finally{c(!1)}},disabled:p},p?(0,l.createElement)(l.Fragment,null,(0,l.createElement)(a.Spinner,null),(0,n.__)("Resetting...","welabs-plugin-composer")):(0,n.__)("Reset Settings","welabs-plugin-composer")))))}window.PluginComposerSettings=r,wp.domReady(()=>{const e=document.getElementById("plugin-composer-settings-app");e&&wp.element.render((0,l.createElement)(r,null),e)})})()})();