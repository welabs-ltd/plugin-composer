(()=>{"use strict";var e={n:l=>{var t=l&&l.__esModule?()=>l.default:()=>l;return e.d(t,{a:t}),t},d:(l,t)=>{for(var a in t)e.o(t,a)&&!e.o(l,a)&&Object.defineProperty(l,a,{enumerable:!0,get:t[a]})},o:(e,l)=>Object.prototype.hasOwnProperty.call(e,l)};(()=>{const l=window.React,t=window.wp.element,a=window.wp.components,n=window.wp.i18n,s=window.wp.apiFetch;var o=e.n(s);function r(){const[e,s]=(0,t.useState)({}),[r,i]=(0,t.useState)(!0),[m,c]=(0,t.useState)(!1),[p,u]=(0,t.useState)(null),[_,g]=(0,t.useState)("general"),[d,b]=(0,t.useState)(!1),[w,h]=(0,t.useState)({});(0,t.useEffect)(()=>{const e=localStorage.getItem("plugin-composer-active-tab");e&&g(e)},[]),(0,t.useEffect)(()=>{y()},[]);const y=async()=>{try{const e=await o()({path:"/plugin-composer/v1/settings",method:"GET"});console.log("Loaded settings:",e),console.log("Loaded settings keys:",Object.keys(e)),s(e)}catch(e){console.error("Error loading settings:",e),u({type:"error",message:(0,n.__)("Error loading settings.","welabs-plugin-composer")})}finally{i(!1)}},f={rate_limit_attempts:{validate:e=>{const l=parseInt(e);return!isNaN(l)&&l>=1&&l<=100},message:(0,n.__)("Rate limit attempts must be between 1 and 100.","welabs-plugin-composer")},rate_limit_duration:{validate:e=>{const l=parseInt(e);return!isNaN(l)&&l>=60&&l<=86400},message:(0,n.__)("Rate limit duration must be between 60 and 86400 seconds.","welabs-plugin-composer")},max_plugin_name_length:{validate:e=>{const l=parseInt(e);return!isNaN(l)&&l>=10&&l<=200},message:(0,n.__)("Plugin name length must be between 10 and 200 characters.","welabs-plugin-composer")},max_description_length:{validate:e=>{const l=parseInt(e);return!isNaN(l)&&l>=50&&l<=2e3},message:(0,n.__)("Description length must be between 50 and 2000 characters.","welabs-plugin-composer")},max_license_length:{validate:e=>{const l=parseInt(e);return!isNaN(l)&&l>=10&&l<=100},message:(0,n.__)("License length must be between 10 and 100 characters.","welabs-plugin-composer")},max_author_name_length:{validate:e=>{const l=parseInt(e);return!isNaN(l)&&l>=10&&l<=200},message:(0,n.__)("Author name length must be between 10 and 200 characters.","welabs-plugin-composer")},file_permissions:{validate:e=>{const l=parseInt(e);return!isNaN(l)&&l>=400&&l<=777},message:(0,n.__)("File permissions must be between 400 and 777.","welabs-plugin-composer")},file_cleanup_delay:{validate:e=>{const l=parseInt(e);return!isNaN(l)&&l>=1&&l<=1440},message:(0,n.__)("File cleanup delay must be between 1 and 1440 minutes.","welabs-plugin-composer")},default_namespace:{validate:e=>e&&e.length>0&&/^[A-Z][a-zA-Z0-9_]*(\/[A-Z][a-zA-Z0-9_]*)*$/.test(e),message:(0,n.__)("Default namespace must start with a capital letter and contain only letters, numbers, and underscores.","welabs-plugin-composer")},default_author_name:{validate:e=>e&&e.length>0&&e.length<=100,message:(0,n.__)("Default author name must not be empty and must be 100 characters or less.","welabs-plugin-composer")},default_author_url:{validate:e=>e&&e.length>0&&/^https?:\/\/.+/.test(e),message:(0,n.__)("Default author URL must be a valid URL starting with http:// or https://","welabs-plugin-composer")}},E=(e,l)=>{s(t=>({...t,[e]:l}));const t=((e,l)=>{if(!f[e])return null;const t=f[e];return t.validate(l)?null:t.message})(e,l);h(l=>({...l,[e]:t}))},v=e=>{const t=w[e];return t?(0,l.createElement)("p",{style:{color:"#d63638",fontSize:"12px",marginTop:"4px",marginBottom:"0",fontWeight:"500"}},t):null},x=()=>{b(!0)},C=()=>{b(!1)};return r?(0,l.createElement)("div",{style:{textAlign:"center",padding:"20px"}},(0,l.createElement)(a.Spinner,null),(0,l.createElement)("p",null,(0,n.__)("Loading settings...","welabs-plugin-composer"))):(0,l.createElement)("div",{className:"plugin-composer-settings"},p&&(0,l.createElement)(a.Notice,{status:p.type,isDismissible:!0,onRemove:()=>u(null)},p.message),(0,l.createElement)(a.TabPanel,{className:"plugin-composer-tabs",activeClass:"active-tab",initialTabName:_,onSelect:e=>{g(e),localStorage.setItem("plugin-composer-active-tab",e)},tabs:[{name:"general",title:(0,n.__)("General","welabs-plugin-composer"),className:"tab-general"},{name:"rate-limiting",title:(0,n.__)("Rate Limiting","welabs-plugin-composer"),className:"tab-rate-limiting"},{name:"validation",title:(0,n.__)("Validation Rules","welabs-plugin-composer"),className:"tab-validation"},{name:"file-settings",title:(0,n.__)("File Settings","welabs-plugin-composer"),className:"tab-file-settings"},{name:"advanced",title:(0,n.__)("Advanced","welabs-plugin-composer"),className:"tab-advanced"}]},t=>{var s,o,r,i;return(0,l.createElement)("div",{className:`tab-content tab-${t.name}`},(0,l.createElement)(a.Card,null,(0,l.createElement)(a.CardHeader,null,(0,l.createElement)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},(0,l.createElement)("div",null,(0,l.createElement)("h3",{style:{margin:0,fontSize:"1.2em",fontWeight:"500"}},(i=t.name,{general:(0,n.__)("General","welabs-plugin-composer"),"rate-limiting":(0,n.__)("Rate Limiting","welabs-plugin-composer"),validation:(0,n.__)("Validation Rules","welabs-plugin-composer"),"file-settings":(0,n.__)("File Settings","welabs-plugin-composer"),advanced:(0,n.__)("Advanced","welabs-plugin-composer")}[i]||i))),(0,l.createElement)(a.Button,{isSecondary:!0,onClick:x,disabled:m,style:{marginLeft:"auto"}},(0,n.__)("Reset to Defaults","welabs-plugin-composer")))),(0,l.createElement)(a.CardBody,null,"general"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.ToggleControl,{label:(0,n.__)("Allow Guest Access","welabs-plugin-composer"),help:(0,n.__)("Allow non-logged-in users to generate plugins","welabs-plugin-composer"),checked:e.allow_guest_access||!1,onChange:e=>E("allow_guest_access",e)}))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.SelectControl,{label:(0,n.__)("Required Capability","welabs-plugin-composer"),help:(0,n.__)("Minimum capability required for logged-in users","welabs-plugin-composer"),value:e.required_capability||"edit_posts",options:[{label:(0,n.__)("Read","welabs-plugin-composer"),value:"read"},{label:(0,n.__)("Edit Posts","welabs-plugin-composer"),value:"edit_posts"},{label:(0,n.__)("Publish Posts","welabs-plugin-composer"),value:"publish_posts"},{label:(0,n.__)("Manage Options","welabs-plugin-composer"),value:"manage_options"}],onChange:e=>E("required_capability",e)}))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.SelectControl,{label:(0,n.__)("Default Plugin Type","welabs-plugin-composer"),help:(0,n.__)("Default plugin type when generating new plugins","welabs-plugin-composer"),value:e.default_plugin_type||"container_based",options:[{label:(0,n.__)("Container Based","welabs-plugin-composer"),value:"container_based"},{label:(0,n.__)("Classic","welabs-plugin-composer"),value:"classic"}],onChange:e=>E("default_plugin_type",e)}))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{label:(0,n.__)("Default Namespace","welabs-plugin-composer"),help:(0,n.__)("Default namespace for generated plugins (e.g., MyPlugin or AB/AC for multi-word)","welabs-plugin-composer"),value:null!==(s=e.default_namespace)&&void 0!==s?s:"MyPlugin",onChange:e=>E("default_namespace",e),placeholder:"MyPlugin",className:w.default_namespace?"has-error":""}),v("default_namespace"))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{label:(0,n.__)("Default Author Name","welabs-plugin-composer"),help:(0,n.__)("Default author name for generated plugins","welabs-plugin-composer"),value:null!==(o=e.default_author_name)&&void 0!==o?o:"Your Name",onChange:e=>E("default_author_name",e),placeholder:"Your Name",className:w.default_author_name?"has-error":""}),v("default_author_name"))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{label:(0,n.__)("Default Author URL","welabs-plugin-composer"),help:(0,n.__)("Default author URL for generated plugins","welabs-plugin-composer"),value:null!==(r=e.default_author_url)&&void 0!==r?r:"https://example.com",onChange:e=>E("default_author_url",e),placeholder:"https://example.com",className:w.default_author_url?"has-error":""}),v("default_author_url")))),"rate-limiting"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.RangeControl,{label:(0,n.__)("Rate Limit Attempts","welabs-plugin-composer"),help:(0,n.__)("Maximum number of plugin generation attempts per time period","welabs-plugin-composer"),value:e.rate_limit_attempts||5,onChange:e=>E("rate_limit_attempts",e),min:1,max:100}),v("rate_limit_attempts"))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Rate Limit Duration (seconds)","welabs-plugin-composer"),help:(0,n.__)("Time period for rate limiting in seconds","welabs-plugin-composer"),value:e.rate_limit_duration||3600,onChange:e=>E("rate_limit_duration",e),className:w.rate_limit_duration?"has-error":""}),v("rate_limit_duration")))),"validation"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Max Plugin Name Length","welabs-plugin-composer"),help:(0,n.__)("Maximum allowed length for plugin names","welabs-plugin-composer"),value:e.max_plugin_name_length||100,onChange:e=>E("max_plugin_name_length",e),className:w.max_plugin_name_length?"has-error":""}),v("max_plugin_name_length"))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Max Description Length","welabs-plugin-composer"),help:(0,n.__)("Maximum allowed length for plugin descriptions","welabs-plugin-composer"),value:e.max_description_length||500,onChange:e=>E("max_description_length",e),className:w.max_description_length?"has-error":""}),v("max_description_length"))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Max License Length","welabs-plugin-composer"),help:(0,n.__)("Maximum allowed length for license text","welabs-plugin-composer"),value:e.max_license_length||50,onChange:e=>E("max_license_length",e),className:w.max_license_length?"has-error":""}),v("max_license_length"))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("Max Author Name Length","welabs-plugin-composer"),help:(0,n.__)("Maximum allowed length for author names","welabs-plugin-composer"),value:e.max_author_name_length||100,onChange:e=>E("max_author_name_length",e),className:w.max_author_name_length?"has-error":""}),v("max_author_name_length")))),"file-settings"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("File Permissions","welabs-plugin-composer"),help:(0,n.__)("Octal permissions for generated files (e.g., 755, 644)","welabs-plugin-composer"),value:e.file_permissions||755,onChange:e=>E("file_permissions",e),className:w.file_permissions?"has-error":""}),v("file_permissions"))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",null,(0,l.createElement)("label",{className:"components-base-control__label"},(0,n.__)("Allowed Plugin Types","welabs-plugin-composer")),(0,l.createElement)("p",{className:"components-base-control__help"},(0,n.__)("Plugin types that users can generate. At least one must be selected.","welabs-plugin-composer")),(0,l.createElement)("div",{style:{marginTop:"8px"}},(0,l.createElement)("label",{style:{display:"flex",alignItems:"center",marginBottom:"8px"}},(0,l.createElement)("input",{type:"checkbox",checked:e.allowed_plugin_types?.includes("container_based")||!1,onChange:l=>{const t=e.allowed_plugin_types||["container_based","classic"];if(l.target.checked)E("allowed_plugin_types",[...t,"container_based"]);else{const l=t.filter(e=>"container_based"!==e);l.length>0&&(E("allowed_plugin_types",l),"container_based"===e.default_plugin_type&&E("default_plugin_type",l[0]))}},style:{marginRight:"8px"}}),(0,n.__)("Container Based","welabs-plugin-composer")),(0,l.createElement)("label",{style:{display:"flex",alignItems:"center"}},(0,l.createElement)("input",{type:"checkbox",checked:e.allowed_plugin_types?.includes("classic")||!1,onChange:l=>{const t=e.allowed_plugin_types||["container_based","classic"];if(l.target.checked)E("allowed_plugin_types",[...t,"classic"]);else{const l=t.filter(e=>"classic"!==e);l.length>0&&(E("allowed_plugin_types",l),"classic"===e.default_plugin_type&&E("default_plugin_type",l[0]))}},style:{marginRight:"8px"}}),(0,n.__)("Classic","welabs-plugin-composer"))),e.allowed_plugin_types&&0===e.allowed_plugin_types.length&&(0,l.createElement)("p",{style:{color:"#d63638",fontSize:"12px",marginTop:"4px"}},(0,n.__)("At least one plugin type must be selected.","welabs-plugin-composer")))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{label:(0,n.__)("Allowed File Extensions","welabs-plugin-composer"),help:(0,n.__)("Comma-separated list of allowed file extensions","welabs-plugin-composer"),value:Array.isArray(e.allowed_file_extensions)?e.allowed_file_extensions.join(", "):"",onChange:e=>E("allowed_file_extensions",e.split(",").map(e=>e.trim()).filter(e=>e)),placeholder:"php, js, css, json, md, txt, xml"})))),"advanced"===t.name&&(0,l.createElement)(a.PanelBody,null,(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.ToggleControl,{label:(0,n.__)("Enable Debug Mode","welabs-plugin-composer"),help:(0,n.__)("Enable detailed logging for troubleshooting","welabs-plugin-composer"),checked:e.enable_debug_mode||!1,onChange:e=>E("enable_debug_mode",e)}))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.ToggleControl,{label:(0,n.__)("Auto-cleanup Generated Files","welabs-plugin-composer"),help:(0,n.__)("Automatically clean up generated files after download","welabs-plugin-composer"),checked:e.auto_cleanup_files||!0,onChange:e=>E("auto_cleanup_files",e)}))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.TextControl,{type:"number",label:(0,n.__)("File Cleanup Delay (minutes)","welabs-plugin-composer"),help:(0,n.__)("Time to wait before cleaning up generated files","welabs-plugin-composer"),value:e.file_cleanup_delay||30,onChange:e=>E("file_cleanup_delay",e),className:w.file_cleanup_delay?"has-error":""}),v("file_cleanup_delay"))),(0,l.createElement)(a.PanelRow,null,(0,l.createElement)("div",{style:{width:"100%"}},(0,l.createElement)(a.ToggleControl,{label:(0,n.__)("Enable Plugin Preview","welabs-plugin-composer"),help:(0,n.__)("Allow users to preview generated plugins before download","welabs-plugin-composer"),checked:e.enable_plugin_preview||!1,onChange:e=>E("enable_plugin_preview",e)})))))))}),(0,l.createElement)("div",{style:{marginTop:"20px",display:"flex",justifyContent:"flex-start",alignItems:"center"}},(0,l.createElement)(a.Button,{isPrimary:!0,onClick:async()=>{if(c(!0),u(null),Object.values(w).some(e=>null!==e))return u({type:"error",message:(0,n.__)("Please fix validation errors before saving.","welabs-plugin-composer")}),void c(!1);console.log("Saving settings:",e),console.log("Settings keys:",Object.keys(e)),console.log("Rate limit attempts value:",e.rate_limit_attempts,"Type:",typeof e.rate_limit_attempts);try{const l=await o()({path:"/plugin-composer/v1/settings",method:"POST",data:e});l.success?(await y(),u({type:"success",message:(0,n.__)("Settings saved successfully!","welabs-plugin-composer")})):u({type:"error",message:l.errors?l.errors.join(", "):(0,n.__)("Error saving settings.","welabs-plugin-composer")})}catch(e){console.error("Error saving settings:",e);let l=(0,n.__)("Error saving settings.","welabs-plugin-composer");e.data&&e.data.errors&&(l=Array.isArray(e.data.errors)?e.data.errors.join(", "):e.data.errors),u({type:"error",message:l})}finally{c(!1)}},disabled:m},m?(0,l.createElement)(l.Fragment,null,(0,l.createElement)(a.Spinner,null),(0,n.__)("Saving...","welabs-plugin-composer")):(0,n.__)("Save Settings","welabs-plugin-composer"))),d&&(0,l.createElement)(a.Modal,{title:(0,n.__)("Confirm Reset","welabs-plugin-composer"),onClose:C,shouldCloseOnClickOutside:!1},(0,l.createElement)("div",{style:{padding:"20px"}},(0,l.createElement)("p",null,(0,n.__)("Are you sure you want to reset all settings to their default values?","welabs-plugin-composer")),(0,l.createElement)("p",{style:{color:"#d63638",fontSize:"12px",marginTop:"4px"}},(0,n.__)("This action cannot be undone.","welabs-plugin-composer"))),(0,l.createElement)("div",{style:{padding:"20px",display:"flex",justifyContent:"flex-end",gap:"10px"}},(0,l.createElement)(a.Button,{isSecondary:!0,onClick:C},(0,n.__)("Cancel","welabs-plugin-composer")),(0,l.createElement)(a.Button,{isPrimary:!0,onClick:async()=>{b(!1),c(!0),u(null);try{(await o()({path:"/plugin-composer/v1/settings/reset",method:"POST"})).success?(await y(),u({type:"success",message:(0,n.__)("Settings reset to defaults successfully!","welabs-plugin-composer")})):u({type:"error",message:(0,n.__)("Error resetting settings.","welabs-plugin-composer")})}catch(e){console.error("Error resetting settings:",e),u({type:"error",message:(0,n.__)("Error resetting settings.","welabs-plugin-composer")})}finally{c(!1)}},disabled:m},m?(0,l.createElement)(l.Fragment,null,(0,l.createElement)(a.Spinner,null),(0,n.__)("Resetting...","welabs-plugin-composer")):(0,n.__)("Reset Settings","welabs-plugin-composer")))))}window.PluginComposerSettings=r,wp.domReady(()=>{const e=document.getElementById("plugin-composer-settings-app");e&&wp.element.render((0,l.createElement)(r,null),e)})})()})();